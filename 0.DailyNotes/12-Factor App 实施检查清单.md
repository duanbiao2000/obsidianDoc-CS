# 12-Factor App 实施检查清单
> 🎯 **团队协作工具** - 确保每个项目都符合12-Factor标准
> 
> 📊 **使用方法**：团队成员共同检查，每项都达到✅才可上线

---

## 🚀 项目信息
- **项目名称**：_________________
- **检查日期**：_________________  
- **检查人员**：_________________
- **项目阶段**：[ ] 开发 [ ] 测试 [ ] 预发布 [ ] 生产

---

## 📋 核心检查项（必须100%通过）

### 1️⃣ 代码库 (Codebase)
- [ ] **单一仓库**：一个应用对应一个Git仓库
- [ ] **多环境分支**：通过分支或标签管理不同环境
- [ ] **版本追溯**：能从任意部署追溯到具体commit
- [ ] **无硬编码环境**：代码中无`if env == "production"`判断

**验证命令**：
```bash
[ $(find . -name ".git" | wc -l) -eq 1 ] && echo "✅ 单一仓库"
```

### 2️⃣ 依赖 (Dependencies)  
- [ ] **依赖文件存在**：requirements.txt/package.json/go.mod等
- [ ] **版本精确锁定**：无`^`、`~`、`*`等模糊版本
- [ ] **虚拟环境隔离**：不使用全局包
- [ ] **构建可重现**：相同代码+依赖=相同结果

**验证命令**：
```bash
# Python
[ -f "requirements.txt" ] && echo "✅ Python依赖声明"
echo $VIRTUAL_ENV && echo "✅ 虚拟环境激活"

# Node.js  
[ -f "package-lock.json" ] && echo "✅ Node依赖锁定"
```

### 3️⃣ 配置 (Config)
- [ ] **环境变量存储**：所有配置通过环境变量注入
- [ ] **敏感信息分离**：密钥、数据库密码不在代码中
- [ ] **配置层次化**：开发/测试/生产环境配置清晰
- [ ] **开源安全测试**：代码可以立即开源不泄露

**验证命令**：
```bash  
# 检查是否有硬编码配置
grep -r "password\|secret\|key" src/ && echo "❌ 可能存在硬编码"
```

### 4️⃣ 后端服务 (Backing Services)
- [ ] **服务URL配置化**：数据库/Redis等通过环境变量配置
- [ ] **本地/云服务切换**：可无缝切换本地和云端服务
- [ ] **服务解耦**：应用与具体数据库品牌无强绑定
- [ ] **故障降级**：后端服务不可用时有降级策略

**验证命令**：
```bash
# 检查是否有硬编码服务地址
grep -r "localhost\|127.0.0.1\|192.168" config/ && echo "❌ 硬编码地址"
```

### 5️⃣ 构建/发布/运行 (Build, Release, Run)
- [ ] **构建自动化**：有Dockerfile或构建脚本
- [ ] **发布版本化**：每次发布有唯一版本标识
- [ ] **运行时不变**：运行时不修改代码
- [ ] **构建一次多部署**：相同构建物部署到不同环境

**验证命令**：
```bash
[ -f "Dockerfile" ] && echo "✅ 容器化构建"
git tag --list | grep -E "v[0-9]" && echo "✅ 版本标签"
```

### 6️⃣ 进程 (Processes)
- [ ] **无状态设计**：进程重启不影响用户会话
- [ ] **状态外部存储**：会话存Redis，文件存对象存储
- [ ] **进程可替换**：任意进程崩溃可立即重启
- [ ] **水平扩展就绪**：多实例运行无冲突

**验证命令**：
```bash
# 检查是否有内存状态存储
grep -r "session.*\[\]" src/ && echo "❌ 可能有内存状态"
```

### 7️⃣ 端口绑定 (Port Binding)
- [ ] **端口环境变量**：监听端口通过环境变量指定
- [ ] **绑定所有接口**：使用0.0.0.0而非127.0.0.1
- [ ] **端口冲突处理**：多实例可使用不同端口
- [ ] **健康检查端点**：有/health或/metrics端点

**验证命令**：
```bash
grep -r "0.0.0.0" src/ && echo "✅ 绑定所有接口"
```

### 8️⃣ 并发 (Concurrency)
- [ ] **进程模型清晰**：Web进程/Worker进程分离
- [ ] **水平扩展支持**：可启动多个相同进程
- [ ] **负载均衡就绪**：多实例间负载分配
- [ ] **资源隔离**：不同类型进程资源隔离

**验证命令**：
```bash
ps aux | grep -E "(gunicorn|celery)" && echo "✅ 进程模型分离"
```

### 9️⃣ 易处理 (Disposability)
- [ ] **快速启动**：应用启动时间<60秒
- [ ] **优雅关闭**：捕获SIGTERM信号
- [ ] **当前任务完成**：关闭前完成正在处理的请求
- [ ] **故障快速重启**：进程意外退出可立即重启

**验证命令**：
```bash
# 测试优雅关闭
kill -TERM $PID && echo "测试SIGTERM处理"
```

### 🔟 环境一致 (Dev/Prod Parity)
- [ ] **容器化统一**：开发/生产使用相同容器镜像
- [ ] **数据库一致**：开发用PostgreSQL，生产也用PostgreSQL
- [ ] **服务版本一致**：Redis/消息队列等版本相同
- [ ] **部署流程一致**：开发和生产使用相同部署方式

**验证命令**：
```bash
docker --version && echo "✅ Docker环境"
```

### 1️⃣1️⃣ 日志 (Logs)
- [ ] **标准输出**：日志输出到stdout/stderr
- [ ] **结构化日志**：使用JSON格式
- [ ] **日志分级**：ERROR/WARN/INFO/DEBUG清晰
- [ ] **不写文件**：应用不直接写日志文件

**验证命令**：
```bash
# 检查是否写入日志文件
find . -name "*.log" && echo "❌ 发现日志文件"
```

### 1️⃣2️⃣ 管理进程 (Admin Processes)
- [ ] **管理脚本独立**：数据迁移等作为独立进程
- [ ] **环境一致**：管理任务使用相同环境
- [ ] **版本同步**：管理脚本与应用代码版本一致
- [ ] **一次性执行**：管理任务执行完即退出

**验证命令**：
```bash
[ -d "scripts" ] || [ -f "manage.py" ] && echo "✅ 管理脚本存在"
```

---

## 🔍 高级检查项（推荐但非强制）

### 📊 监控与可观测性
- [ ] **性能指标**：响应时间、吞吐量监控
- [ ] **错误追踪**：集成Sentry或类似工具
- [ ] **链路追踪**：分布式追踪支持
- [ ] **业务指标**：关键业务数据监控

### 🛡️ 安全性
- [ ] **依赖安全扫描**：定期检查依赖漏洞
- [ ] **密钥轮换**：支持密钥定期更换
- [ ] **访问控制**：API有鉴权机制
- [ ] **数据加密**：敏感数据加密存储

### 🚀 性能优化
- [ ] **缓存策略**：合理使用Redis缓存
- [ ] **数据库优化**：有索引和查询优化
- [ ] **CDN使用**：静态资源使用CDN
- [ ] **压缩优化**：HTTP响应压缩

---

## 📈 团队协作检查项

### 👥 开发流程
- [ ] **代码审查**：所有代码经过peer review
- [ ] **自动化测试**：有单元测试和集成测试  
- [ ] **CI/CD流水线**：自动构建、测试、部署
- [ ] **文档完整**：README、API文档齐全

### 🔄 运维流程  
- [ ] **回滚方案**：有快速回滚机制
- [ ] **灾难恢复**：有数据备份和恢复流程
- [ ] **故障演练**：定期进行故障演练
- [ ] **监控告警**：关键指标有告警

---

## ✅ 检查结果统计

**核心检查项通过率**：_____ / 48 项 (_____ %)  
**高级检查项通过率**：_____ / 12 项 (_____ %)  
**团队协作检查通过率**：_____ / 8 项 (_____ %)

### 🎯 上线标准
- ✅ **可上线**：核心检查项 ≥ 95% (46/48项)
- ⚠️ **需改进后上线**：核心检查项 80-95% (38-45项)  
- ❌ **不可上线**：核心检查项 < 80% (<38项)

### 📝 问题汇总
**必须修复**：
1. _______________
2. _______________
3. _______________

**建议改进**：
1. _______________
2. _______________
3. _______________

---

## 🛠️ 改进建议

### 立即修复（1-3天）
> 针对核心检查项不通过的问题

### 短期优化（1-2周）  
> 针对高级检查项和团队协作问题

### 长期规划（1-3个月）
> 技术债务和架构优化

---

**检查完成日期**：_______________  
**下次检查计划**：_______________  
**负责人签字**：_______________

> 💡 **使用建议**：
> 1. 新项目启动时必须检查
> 2. 大版本发布前必须检查  
> 3. 每季度定期检查一次
> 4. 团队成员轮流担任检查负责人