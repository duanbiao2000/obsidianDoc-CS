下面把当前后端仓库按“功能模块 → 对应文件 → 重要类/函数（及职责）”的形式列出来，方便快速定位改动点与阅读路径。每一项都写出推荐先读的文件与关键方法／入口。若你想要我把它导出为表格或 mermaid 图，我可以接着生成。

注意：下面只列出代码里可见/引用的主要模块与在代码中实际调用的函数；有些辅助 util/model 文件以被引用为准（我已在描述中给出文件名），如需我把每个文件的完整签名列表也抓取出来，我可以继续自动化完成。

## 1) 启动与全局生命周期

- [main.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 入口：`if __name__ == "__main__":`（uvicorn.run）
    - 生命周期（async lifespan）会在启动时执行：
        - [register_handler()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（events 注册）
        - [init_db()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（在 [init_db.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - [get_transcriber(transcriber_type=...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（在 [transcriber_provider.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - [seed_default_providers()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（在 [provider_dao.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - [ensure_ffmpeg_or_raise()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（[ffmpeg_helper.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
    - 挂载静态目录：[app.mount(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（static, uploads）
- [__init__.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [create_app(lifespan)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：创建 FastAPI 应用并 include routers（[note](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [provider](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [model](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [config](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）

## 2) HTTP 路由层（API）

- 主要目录：[routers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
- 关键文件：[note.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - Endpoints / 函数：
        - `@router.post("/generate_note")` → [generate_note(data, background_tasks)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：校验、产生/复用 task_id、把任务通过 [BackgroundTasks](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 调用 [run_note_task](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
        - [run_note_task(task_id, video_url, platform, ...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：实际在后台调用 [NoteGenerator.generate](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 并保存结果（会写 `note_results/{task_id}.json`）
        - `@router.get("/task_status/{task_id}")` → [get_task_status(task_id)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：读取 `note_results/{task_id}.status.json` 和 `{task_id}.json` 并返回
        - `@router.post("/upload")` → 文件上传（写入 [uploads](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - `@router.post('/delete_task')` → [delete_task](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（占位）
    - 辅助：`save_note_to_file(task_id, note)`（写结果文件）

## 3) 核心业务 / Orchestration

- 目录：[services](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
- 关键文件：[note.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（核心编排类 [NoteGenerator](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
    - [NoteGenerator.generate(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) — 主流程（下载 → 转写 → GPT 总结 → 后处理 → 保存状态/入库）
    - 重要私有方法（按执行顺序）：
        - [_get_downloader(platform)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：返回下载器类（参考 [SUPPORT_PLATFORM_MAP](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - [_download_media(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：负责音视频缓存检查、调用下载器的 [download](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) / [download_video](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，并写下载元信息缓存（`{task_id}_audio.json`）
        - [_transcribe_audio(audio_file, ...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：调用 transcriber 生成转写，写 `{task_id}_transcript.json`
        - [_summarize_text(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：调用 GPT（通过 [GPTFactory](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）生成 Markdown，并缓存
        - [_post_process_markdown(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：插入截图与链接（[_insert_screenshots](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [replace_content_markers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
        - [_update_status(task_id, status, message=None)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：写 `{task_id}.status.json`，采用先写 `.tmp` 再 [replace](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的原子写入模式（重要约定）
        - [_save_metadata(video_id, platform, task_id)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：调用 DB DAO [insert_video_task](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 异常处理：[_handle_exception](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) → 把信息写入状态文件并记录日志

## 4) 下载器（平台适配、yt-dlp 调用）

- 目录：[downloaders](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
- 关键文件与类：
    - [base.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
        - [class Downloader(ABC)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：基类，包含 [self.quality](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [self.cache_data](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（ENV `DATA_DIR`），抽象方法 [download(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 和 [download_video(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [youtube_downloader.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
        - [class YoutubeDownloader(Downloader)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：
            - [download(video_url, output_dir, quality, need_video)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) → 使用 [yt_dlp.YoutubeDL](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 下载音频（返回 [AudioDownloadResult](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
            - [download_video(video_url, output_dir)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) → 下载视频并合并为 mp4
            - （注意）格式字符串（例如 `'bestaudio[ext=m4a]/bestaudio/best'`）及回退机制是常见修改点（易触发 yt-dlp 的 "Requested format is not available"）
    - [bilibili_downloader.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
        - [class BilibiliDownloader(Downloader)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：与 youtube 类似（下载音频/视频、写入路径）
    - 其它：[douyin_downloader.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [local_downloader.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（按目录约定各平台实现 [download/download_video](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
- 返回类型：[AudioDownloadResult](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（位于 [notes_model.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 或 [audio_model.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）

## 5) 转写（Transcriber）子系统

- 目录：[transcriber](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
- 关键文件：[transcriber_provider.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 功能：转写器注册/单例管理，入口 [get_transcriber(transcriber_type, model_size, device)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 提供的方法/工厂：
        - [get_whisper_transcriber(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（fast-whisper）
        - [get_mlx_whisper_transcriber(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（仅 macOS 且可用时）
        - [get_bcut_transcriber()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_kuaishou_transcriber()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_groq_transcriber()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 模式：缓存单例 [_transcribers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，按类型延迟初始化（见 [_init_transcriber](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
- 具体转写实现类位于同目录（[whisper.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [bcut.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [groq.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 等） — 每个类实现 `.transcript(file_path=...)` 方法（[NoteGenerator](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 所调用）

## 6) GPT / AI 层

- 目录：[gpt](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [GPTFactory](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（[gpt_factory.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）根据 [ModelConfig](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 创建 [GPT](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 实例
    - [base.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 定义 [GPT](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 抽象接口（[summarize](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 等）
    - [note.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 将转写/元信息包装为 [GPTSource](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 传给 [gpt.summarize(...)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)

## 7) 数据库（本地 SQLite / SQLAlchemy）

- 目录：[db](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [init_db.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：[init_db()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) → [Base.metadata.create_all(bind=engine)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [engine.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：SQLAlchemy 引擎/Session 管理（用于 [get_engine](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_db](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
    - [provider_dao.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：
        - [seed_default_providers()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) — 读取 `builtin_providers.json` 并写入 Provider 表（注意 PyInstaller [sys._MEIPASS](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 支持）
        - [insert_provider](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_enabled_providers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_provider_by_name](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_provider_by_id](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_all_providers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [update_provider](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [delete_provider](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [video_task_dao.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（插入/查询任务记录: [insert_video_task](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [get_task_by_video](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [delete_task_by_video](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 等）
    - SQLAlchemy model 定义：[app/db/models/*](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（例如 [Model](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [Provider](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html), [VideoTask](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）

## 8) 文件/路径/工具类（utils）

- 目录：[utils](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [path_helper.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：[get_data_dir()](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（下载输出目录获取）
    - [url_parser.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：`extract_video_id(url, platform)`（解析视频 id）
    - [logger.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：[get_logger(__name__)](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - [video_reader.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) / [video_helper.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：生成截图/视频读取（[generate_screenshot](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)、[VideoReader](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
    - [note_helper.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：[replace_content_markers](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（在 Markdown 中替换 link/screenshot）
    - [response.py](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)：[ResponseWrapper](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)
    - 注意：[NoteGenerator._update_status](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 使用原子写文件（先写 `.tmp` 再 [replace](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)） —— 修改此逻辑要谨慎

## 9) 其他关键脚本 / 配置

- 打包脚本：[build.sh](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（Linux/macOS）和 [build.bat](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（Windows） — 使用 PyInstaller，注意 `--add-data app/db/builtin_providers.json:.` 与 `.env` 的复制/清理逻辑
- 依赖：[requirements.txt](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（例如 `yt-dlp==2025.3.31`, `faster-whisper`, `onnxruntime` 等；本地需安装 `ffmpeg`）
- 环境样例：[.env.example](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（项目依赖多个 env 配置）

## 10) I/O / 持久化约定与常见风险点（代码阅读时优先注意）

- 状态/结果文件：目录 [NOTE_OUTPUT_DIR](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)（默认 [note_results](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
    - `{task_id}.status.json`（状态）与 `{task_id}.json`（最终结果）以及 `{task_id}_audio.json` / `{task_id}_transcript.json`
    - 写入采用原子替换（`tmp` → [replace](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）
- 下载器中的格式字符串：`yt-dlp` format 表达式（若固定 [ext=m4a/mp4](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)，在某些视频上会触发 `Requested format is not available`）——修改时应加回退或先获取 [formats](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 列表
- PyInstaller 打包注意：读取资源需要兼容 [sys._MEIPASS](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 的路径处理（见 [provider_dao.get_builtin_providers_path](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html)）

---

如果你需要我把上面的映射导出为：

- 可导航的 Markdown 表格（包含文件行号/函数签名），
- 或者一张 mermaid 架构图（更详细地标出每个方法如 [NoteGenerator._download_media](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) → [YoutubeDownloader.download](vscode-file://vscode-app/c:/Users/danny/AppData/Local/Programs/Microsoft%20VS%20Code/resources/app/out/vs/code/electron-browser/workbench/workbench.html) 等），

我可以继续自动读取文件并生成更细粒度的清单或图（例如把每个函数签名、异常点、调用链都列出来）。你想要哪种下一步？