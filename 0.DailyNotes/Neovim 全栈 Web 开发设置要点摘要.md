## Neovim 全栈 Web 开发设置要点摘要（2024）

本摘要根据“Effective NeoVim Setup for Full-Stack Web Development in 2024”视频内容，详细回顾了作者在2024年为全栈Web开发定制Neovim的设置理念、核心配置、关键插件及其功能。作者强调构建一个“快速且相对极简”的开发环境，专注于“良好的语言服务器集成、直观的文件导航和快速重构”。

### 一、核心理念与目标

- **速度与极简主义：** 作者不偏爱花哨的UI元素（如光标动画、华丽的仪表板），力求保持设置的“快速且相对极简”。
- **关键特性：** 最重要的是“良好的语言服务器集成、直观的文件导航和快速重构”。
- **资源提供：** 完整的设置可在GitHub仓库中找到，并提供了一本免费电子书，详细介绍了所有使用的插件及额外推荐插件。

### 二、基础设置与默认选项

1. **LazyVim 起始配置：**

- 克隆LazyVim starter，因其内置的Lazy插件管理器和优秀的起始配置，只需少量调整。
- **默认启用插件（“必不可少”）：**eslint：用于Linting。
- prettier：用于格式化。
- typescript, json, tailwind：提供语言服务支持。
- GitHub Copilot：加速枯燥任务。
- mini high patterns：用于内联颜色高亮。

1. **默认Vim选项：**

- **Leader键映射：** 将Leader键映射到空格键。
- **编码：** 设置文件类型默认编码为utf8。
- **显示：** 启用行号，使用当前缓冲区名称作为窗口标题，显示搜索结果高亮，显示状态行中的最后一条命令（作者禁用）。
- **缩进：** 启用自动和智能缩进，将制表符转换为空格（每个缩进和制表符输出为两个空格），允许回删缩进和换行。
- **搜索：** 搜索结果不区分大小写，启用命令预览。
- **路径与窗口：** *通配符添加到路径以支持子目录搜索，忽略node_modules，默认在右侧和下方打开分割窗口，关闭窗口时保持光标位置。
- **鼠标：** 禁用鼠标支持。
- **格式化：** 在块注释中自动添加星号。

### 三、关键键绑定与UI美化

1. **通用键绑定：**

- **剪切字符：** 将单个字符剪切映射到下划线寄存器（_，作为“黑洞”），避免污染剪贴板。
- **数字重构：** 细微调整数字重构功能。
- **保存与关闭：** 必备键绑定。
- **标签页与窗口管理：** 使其更直观。
- **错误与诊断：** 快速检查所有错误和诊断。

1. **配色方案：**

- 使用sonokai配色方案。

1. **UI美化与调整：**

- **禁用Dashboard：** 禁用pin dashboard插件，移除恼人的仪表板。
- **禁用状态栏：** 禁用LuaLine，确保状态栏完全移除，以获得更多屏幕空间。
- **消息提示：** 使用noise.nvim替换消息弹出菜单和命令行，禁用“无可用信息”的恼人消息。
- **通知：** 配置nvim-notify的显示选项（右上角通知）。
- **Buffer Tabs：** 使用bufferline提供GUI风格的漂亮标签页，并进行精简配置。
- **文件名称显示：** 使用inline-nvim在所有打开的窗口右上角显示文件名，并修改颜色。

### 四、核心插件与集成

1. **LSP 与自动补全：**

- **mason.nvim：** 包管理器，用于LSP、调试适配器协议、Linter和Formatter（已取代COC.nvim）。
- **nvim-lspconfig：** 配置LSP，例如将TypeScript和Tailwind的根目录设置为.git文件夹所在位置。
- **nvim-cmp：** 提供漂亮的自动补全下拉菜单。
- **cmp-emoji：** 提供花哨的图标。
- **内联提示（Inlay Hints）：** 启用内联提示，提供代码额外信息（需Neovim 0.10及以上版本，可能需要安装nightly build）。

1. **语法高亮与代码结构：**

- **treesitter：** 用于提供语法高亮、缩进和代码折叠，确保默认安装常用语言。

1. **实用工具插件：**

- **mini high patterns：** 直接在终端显示颜色值（例如，十六进制颜色码显示为实际颜色）。
- **telescope：** 快速查找文件、在项目中搜索字符串、预览文件等。
- 绑定了最重要功能键。
- **文件浏览器：** 映射SF键打开文件浏览器。
- 文件浏览器配置：N创建新文件，H导航到父目录，Ctrl+U/D滚动文件。
- **lazy-git：** Git版本控制支持（需系统安装LazyGit），映射到;c键。
- **nvim-tree：** 文件和文件夹树视图。
- 默认配置，但关键设置包括：在新标签页中打开、打开文件时关闭树、忽略node_modules。
- 自动打开树（如果未指定打开文件）。
- 提供切换树和在树中查找当前文件的键绑定。
- **nvim-dap：** 允许直接在Neovim中执行数据库查询。
- 映射space+d关闭nvim-tree并在新标签页中打开DAP UI。
- 通过DBU add connection命令添加数据库连接字符串。

1. **重构插件：**

- **incremental-rename.nvim：** 允许原地重命名变量并更新所有引用，映射到leader+rn。
- **refactoring.nvim：** 允许内联或提取变量、函数，通过高亮代码并按下space+r触发。

1. **集成插件：**

- **rest.nvim：** 直接从Neovim发送HTTP请求。
- 支持各种请求、变量和环境配置。
- 映射backspace+r执行查询。

1. **测试插件：**

- **neotest：** 通用测试插件，支持不同的测试适配器（作者主要使用Jest）。
- **Jest适配器配置：** 特别针对monorepo项目进行额外配置，以正确查找Jest配置文件和包根目录。
- 提供了一系列键绑定。

### 五、总结

作者的Neovim设置为全栈Web开发提供了一个高效、极简且功能强大的环境。它强调通过精心的配置和一系列精心选择的插件，优化了语言服务集成、文件导航、代码重构、版本控制和测试流程，大大提升了开发效率和体验。作者还鼓励观众分享改进建议，并提供了详细的电子书作为额外资源。

**重要提示：** 部分新功能（如内联提示）可能需要Neovim 0.10及以上版本，可能需要安装nightly build。

---

## 详细时间线

**2024年**

- **具体时间不详（视频录制时）**：
- **视频博主**发布“2024年全栈Web开发高效NeoVim设置”视频，展示其NeoVim配置。
- **视频博主**正在一个副项目上工作，并在此过程中展示其NeoVim设置。
- **NeoVim稳定版本为0.9.5**，而内联提示（inlay hints）功能需要0.10及以上版本，用户可能需要安装NeoVim的nightly build才能使用该功能。
- **视频博主**最近搬回其祖国克罗地亚。
- **视频制作与发布过程中涉及的设置步骤**：

1. **克隆LazyVim启动器**：作为基础配置。
2. **启用额外插件**：包括ESLint、Prettier、TypeScript、JSON、Tailwind语言服务支持、GitHub Co-pilot、Mini High Patterns。
3. **设置默认Vim选项**：

- 将Leader键映射到空格键。
- 设置文件类型默认编码为UTF8。
- 启用行号。
- 使Vim使用当前缓冲区名称作为窗口标题。
- 启用自动和智能缩进。
- 突出显示搜索结果。
- 禁用备份。
- 显示最后一条命令（虽然视频博主不使用）。
- 禁用命令行和状态行。
- 将制表符转换为空格。
- 确保光标上方和下方至少显示10行。
- 启用命令预览。
- 使搜索结果不区分大小写。
- 确保Tab键尽可能输出空格。
- 在启用换行时添加缩进。
- 设置每个缩进为两个空格，Tab默认输出两个空格。
- 禁用行包装（line wrap），但定义了包装缩进量。
- 允许回退删除缩进、换行和插入开始处的空白。
- 将星号通配符添加到路径中，以便在子目录中执行搜索。
- 忽略node_modules文件夹。
- 默认在右侧和下方打开拆分窗口。
- 关闭窗口时保持光标在同一位置。
- 禁用鼠标支持。
- 添加格式化选项，在块注释中预先添加星号。

1. **定义有用的键绑定**：

- 将单字符剪切映射到下划线寄存器。
- 对数字重构进行微调。
- 配置保存和关闭的键绑定。
- 配置标签页管理键绑定。
- 配置窗口管理键绑定。
- 配置快速检查错误和诊断的键绑定。

1. **设置配色方案**：使用sonokai。
2. **配置LSP和自动补全**：

- 安装mason.nvim（取代coc.nvim和nvim-lsp-installer）。
- 配置nvim-lspconfig，为TypeScript和Tailwind设置项目根目录，并启用内联提示（inlay hints）。
- 安装nvim-cmp提供自动补全下拉菜单。
- 安装Emoji库以获取图标。

1. **安装Tree-sitter**：确保主要语言的语法高亮、缩进和折叠功能。
2. **添加Mini High Patterns插件**：直接在终端显示颜色值。
3. **设置Telescope插件**：

- 绑定查找文件、项目内字符串搜索、文件预览等功能。
- 将文件浏览器映射到SF键绑定。
- 配置文件浏览器：N键创建新文件，H键导航到父目录，Ctrl+U/D滚动文件。

1. **UI调整**：

- 禁用dashboard-nvim插件和lualine插件，完全移除状态行。
- 配置noice.nvim替换消息弹窗和命令行，并禁用“无信息可用”消息。
- 配置nvim-notify的通知设计选项。
- 配置bufferline以获得漂亮的标签页外观。
- 配置inline-nvim显示所有打开窗口的文件名。

1. **集成lazy-git**：将semicolon + C映射到打开lazy-git界面（需要系统已安装lazy-git）。
2. **添加nvim-tree**：

- 大部分使用默认配置。
- 配置在新标签页打开文件和打开文件后关闭树的键绑定。
- 忽略node_modules。
- 如果打开NeoVim时未指定文件，则自动打开文件树。
- 添加切换文件树和在树中查找当前文件的键绑定。

1. **集成dadbod.nvim**：

- 添加键绑定，关闭nvim-tree并在新标签页中打开dadbod。
- 允许执行数据库查询和修改。
- 提到用户可以添加数据库连接。

1. **添加重构插件**：

- incremental-rename.nvim：绑定到leader + RN，实现变量原地重命名。
- refactoring.nvim：绑定到space + R，用于提取或内联变量/函数。

1. **集成rest.nvim**：

- 大部分使用默认配置。
- 映射backspace + R执行HTTP请求。

1. **添加neotest**：

- 作为通用测试插件，通过适配器支持多种测试框架（视频博主主要使用Jest）。
- 配置neotest-jest，以支持单体仓库（monorepos）中的Jest配置和包根目录查找。
- 配置测试运行的键绑定。